{% extends "base.html" %}
{% block content %}
<body class="bg-amber-100 py-10 px-4 text-gray-800">
<div class="max-w-5xl mx-auto bg-white rounded-xl shadow-lg p-8 space-y-10">

  <div class="text-center">
    {% if user.profile_picture %}
      <img src="{{ user.profile_picture.url }}" alt="Profile Picture"
           class="mx-auto w-32 h-32 rounded-full border-4 border-primary object-cover">
    {% else %}
      <div class="mx-auto w-32 h-32 rounded-full bg-gray-300 flex items-center justify-center text-3xl text-white">ðŸ‘¤</div>
    {% endif %}
    <h1 class="text-2xl font-bold mt-4">Hello, {{ user.first_name }}</h1>
    <p class="text-gray-600">Mobile: {{ user.mobile }}</p>
  </div>

  <div class="grid md:grid-cols-2 gap-8">

    <!-- Final Orders -->
    <div>
      <h2 class="text-xl font-semibold mb-2 border-b pb-1">My Final Orders</h2>

      {% for f_order in final_orders %}
        <div class="bg-yellow-50 rounded-lg border border-amber-200 shadow p-4 mb-4">
          <h3 class="font-semibold text-amber-900">
            Final Order ID: {{ f_order.id }}
            <span class="block sm:inline text-gray-500 text-sm">| Date: {{ f_order.time|date:"Y-m-d H:i" }}</span>
            <span class="block sm:inline sm:ml-4 text-sm font-medium
              {% if f_order.status == 'paid' %}text-blue-600
              {% elif f_order.status == 'delivered' %}text-green-600
              {% elif f_order.status == 'canceled' %}text-red-600
              {% else %}text-gray-500{% endif %}">
              Status: {{ f_order.get_status_display }}
            </span>
          </h3>

          <ul class="space-y-2 mt-2 pl-4 list-disc">
            {% for order in f_order.orders.all %}
              {% for item in order.items.all %}
                <li>
                  {{ item.quantity }} Ã— {{ item.product.title }}
                  <span class="ml-2 text-sm {% if order.status == 'pending' %}text-yellow-600
                                              {% elif order.status == 'delivered' %}text-green-600
                                              {% elif order.status == 'canceled' %}text-red-600
                                              {% else %}text-gray-500{% endif %}">
                    ({{ order.get_status_display }})
                  </span>
                </li>
              {% endfor %}
            {% endfor %}
          </ul>

          <p class="mt-2 font-semibold text-gray-800 text-right">
            Total: <span class="text-green-700">{{ f_order.total_price }},000 Toman</span>
          </p>
        </div>
      {% empty %}
        <p class="text-gray-500">You have no final orders.</p>
      {% endfor %}
    </div>

    <!-- Favorites -->
    <div>
      <h2 class="text-xl font-semibold mb-2 border-b pb-1">Favorites</h2>
      <ul class="space-y-2">
        {% for fav in favorites %}
          <li class="flex flex-col sm:flex-row sm:justify-between sm:items-center border-b pb-2">
            <span>{{ fav.product.title }}</span>
            <a href="{% url 'create_order' fav.product.pk %}"
               class="mt-2 sm:mt-0 bg-yellow-400 hover:bg-yellow-500 text-sm text-black px-3 py-1 rounded">
               Order Again
            </a>
          </li>
        {% empty %}
          <li class="text-gray-500">No favorite products.</li>
        {% endfor %}
      </ul>
    </div>

  </div>

  <!-- Ratings & Comments can remain same -->
  <div class="grid md:grid-cols-2 gap-8">

    <div>
      <h2 class="text-xl font-semibold mb-2 border-b pb-1">Ratings</h2>
      <ul class="space-y-1 pl-4 list-disc">
        {% for rating in ratings %}
          <li>{{ rating.product.title }} â€“ Score: {{ rating.score }}</li>
        {% empty %}
          <li class="text-gray-500">No ratings yet.</li>
        {% endfor %}
      </ul>
    </div>

    <div>
      <h2 class="text-xl font-semibold mb-2 border-b pb-1">Comments</h2>
      <ul class="space-y-1 pl-4 list-disc">
        {% for comment in comments %}
          <li>{{ comment.product.title }} - "{{ comment.text }}"
            <span class="ml-2 text-sm {% if comment.is_approved %}text-green-600 {% else %}text-yellow-600{% endif %}">
              ({{ comment.is_approved|yesno:"approved,pending" }})
            </span>
          </li>
        {% empty %}
          <li class="text-gray-500">No comments yet.</li>
        {% endfor %}
      </ul>
    </div>

  </div>

  <!-- Action Buttons -->
  <div class="flex flex-col sm:flex-row sm:flex-wrap justify-center gap-4 pt-6 border-t">
    <a href="{% url 'edit-profile' %}" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-center w-full sm:w-auto"> Edit Profile </a>
    <a href="{% url 'change_password' %}" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded text-center w-full sm:w-auto"> Change Password </a>
    <form action="{% url 'logout' %}" method="post" class="w-full sm:w-auto text-center">
      {% csrf_token %}
      <button type="submit" class="w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded"> Logout </button>
    </form>
    <a href="{% url 'home' %}" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded text-center w-full sm:w-auto"> Back to Home </a>
  </div>

</div>
</body>
{% endblock %}